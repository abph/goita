<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>ごいた 10×10盤面</title>
  <style>
    body { font-family: sans-serif; max-width: 1250px; margin: 20px auto; }
    .row { display: flex; gap: 16px; align-items: flex-start; }
    .panel { width: 420px; border: 1px solid #ddd; border-radius: 12px; padding: 12px; }
    .board-wrap { border: 1px solid #ddd; border-radius: 12px; padding: 12px; }

    .board {
      display: grid;
      grid-template-columns: repeat(10, 58px);
      grid-template-rows: repeat(10, 58px);
      gap: 6px;
      user-select: none;
    }
    .cell {
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      background: #fafafa;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .slot { border: 2px solid #999; background: #fff; }
    .slot .val { font-size: 18px; font-weight: 800; }

    .hand { border: 2px solid #4a90e2; background: #fff; }
    .hand .val { font-size: 18px; font-weight: 900; }

    .hand.clickable { cursor: pointer; }
    .hand.clickable:hover { outline: 3px solid rgba(74,144,226,0.35); }

    /* ★ パスボタン用 */
    .pass {
      background: #fff3f3;
      border: 3px solid #e74c3c;
      cursor: pointer;
      font-weight: 900;
      color: #e74c3c;
    }
    .pass:hover { background: #ffecec; }

    pre { background:#f7f7f7; padding:10px; border-radius:10px; max-height: 480px; overflow:auto; }
  </style>
</head>
<body>
<h1>ごいた 10×10盤面</h1>

<div class="row">
  <div class="board-wrap">
    <div id="board" class="board"></div>
  </div>

  <div class="panel">
    <button onclick="newGame()">新規ゲーム</button>
    <pre id="log"></pre>
  </div>
</div>

<script>
const API = "";
let gid = null;
let latestState = null;
let latestLegal = [];

/* ===== 駒表示 ===== */
const PIECE_LABEL = {
  "9":"王","8":"玉","7":"飛","6":"角","5":"金","4":"銀","3":"馬","2":"香","1":"し"
};
function pieceToLabel(v){ return PIECE_LABEL[v] ?? v; }

/* ===== パス処理 ===== */
async function onPassClick(){
  if(!gid) return;
  const pass = latestLegal.find(a => a.action_type === "pass");
  if(!pass){
    alert("今はパスできません");
    return;
  }
  await fetch(`${API}/games/${gid}/step`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:pass})
  });
  await refresh();
}

/* ===== 盤面描画 ===== */
function renderBoard(state){
  const board = document.getElementById("board");
  board.innerHTML = "";

  for(let row=1; row<=10; row++){
    for(let col=1; col<=10; col++){
      const div = document.createElement("div");
      div.className = "cell";
      div.style.gridColumn = col;
      div.style.gridRow = row;

      /* ★ プレイヤーA パスボタン (8,9) */
      if(col===8 && row===9){
        div.classList.add("pass");
        div.textContent = "PASS";
        if(state.turn==="A" && !state.finished){
          div.onclick = onPassClick;
        }else{
          div.style.opacity = 0.4;
        }
        board.appendChild(div);
        continue;
      }

      board.appendChild(div);
    }
  }
}

/* ===== 更新 ===== */
async function refresh(){
  if(!gid) return;
  const s = await (await fetch(`${API}/games/${gid}/state`)).json();
  latestState = s;
  latestLegal = await (await fetch(`${API}/games/${gid}/legal_actions`)).json();
  document.getElementById("log").textContent = (s.log||[]).join("\n");
  renderBoard(s);
}

async function newGame(){
  const r = await fetch(`${API}/games`,{method:"POST"});
  const j = await r.json();
  gid = j.game_id;
  await refresh();
}
</script>
</body>
</html>
